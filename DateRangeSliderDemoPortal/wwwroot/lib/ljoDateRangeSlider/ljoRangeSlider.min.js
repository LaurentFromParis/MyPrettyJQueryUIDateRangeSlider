$.widget("ljo.rangeSlider",{version:"0.9.5",element:null,slider:null,leftHandle:null,rightHandle:null,mainHandle:null,_garbageCollector:[],_periodicityAllowedValues:["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],defaultElement:"<div>",options:{behavior:{draggable:!0,dateMode:{periodicity:"days",locale:"fr"}},layout:{backgroundColor:"#eee",sliderBackgroundColor:"#ccc"},range:{bounds:{min:moment().startOf("year").toDate(),max:moment().endOf("year").toDate()},values:{min:moment().startOf("month").toDate(),max:moment().endOf("month").toDate()}},change:null},_create:function(){moment.locale(this.options.behavior.dateMode.locale);this.element.addClass("ljo-rangeSlider").css("background-color",this.options.layout.backgroundColor).on("mouseup",function(n){var t=$(this).data("ljo-rangeSlider"),r=$(this).find(".ljo-rangeSlider-Slider"),u=r.offset().left-r.parent().offset().left,i=t.options.range.values.min;n.offsetX<u?(i=moment(t.options.range.values.min).add(-1,t.options.behavior.dateMode.periodicity).toDate(),moment(i).diff(moment(t.options.range.bounds.min),"milliseconds")<=0&&(i=t.options.range.bounds.min)):n.offsetX>u+r.width()&&(i=moment(t.options.range.values.min).add(1,t.options.behavior.dateMode.periodicity).toDate(),moment(moment(t.options.range.bounds.max).diff(i),"milliseconds")<=0&&(i=t.options.range.bounds.max));var f=moment(t.options.range.bounds.max).diff(moment(t.options.range.bounds.min),"milliseconds"),e=moment(t.options.range.values.max).diff(moment(t.options.range.values.min),"milliseconds"),o=moment(i).diff(moment(t.options.range.values.min),"milliseconds");t.options.range.values.min=i;t.options.range.values.max=moment(t.options.range.values.min).add(e,"milliseconds").toDate();var s=$(this).width()-r.width(),h=s/f,c=o*h;r.css("left",u+c+"px");$(this).find("[data-role='valuesmin']").text(moment(t.options.range.values.min).format("DD/MM/YYYY"));$(this).find("[data-role='valuesmax']").text(moment(t.options.range.values.max).format("DD/MM/YYYY"));console.log("ljo.rangeSlider drag"+moment(t.options.range.values.min).format("YYYY-MM-DDThh:mm:ss")+" to "+moment(t.options.range.values.max).format("YYYY-MM-DDThh:mm:ss"));t._refresh(n);t._trigger("change",event,t.options.range)});this.generatedElementSlider=$("<div>",{"class":"ljo-rangeSlider-h ljo-rangeSlider-Slider"}).appendTo(this.element).css("width",this._sliderWidth()).css("background-color",this.options.layout.sliderBackgroundColor).draggable({axis:"x",containment:"parent",drag:function(n,t){var i=$(this).parent().data("ljo-rangeSlider"),u=moment(i.options.range.bounds.max).diff(moment(i.options.range.bounds.min),"milliseconds"),r=moment(i.options.range.values.max).diff(moment(i.options.range.values.min),"milliseconds"),f=$(this).parent().width()-$(this).width(),e=parseInt((u-r)*t.position.left/f);i.options.range.values.min=moment(i.options.range.bounds.min).add(e,"milliseconds").toDate();i.options.range.values.max=moment(i.options.range.values.min).add(r,"milliseconds").toDate();$(this).parent().find("[data-role='valuesmin']").text(moment(i.options.range.values.min).format("DD/MM/YYYY"));$(this).parent().find("[data-role='valuesmax']").text(moment(i.options.range.values.max).format("DD/MM/YYYY"));console.log("ljo.rangeSlider drag"+moment(i.options.range.values.min).format("YYYY-MM-DDThh:mm:ss")+" to "+moment(i.options.range.values.max).format("YYYY-MM-DDThh:mm:ss"))},stop:function(n){console.log("ljo.rangeSlider dragStop");var t=$(this).parent().data("ljo-rangeSlider");$(this).parent().find("[data-role='valuesmin']").text(moment(t.options.range.values.min).format("DD/MM/YYYY"));$(this).parent().find("[data-role='valuesmax']").text(moment(t.options.range.values.max).format("DD/MM/YYYY"));t._refresh(n);t._trigger("change",n,t.options.range)}});this._garbageCollector.push(this.generatedElementSlider);this.generatedElementBoundMinCont=$("<table>",{"class":"ljo-rangeSlider-minBoundCont"}).css("height",$(this.element).height()+"px").appendTo(this.element);this._garbageCollector.push(this.generatedElementBoundMinCont);this.generatedElementBoundMaxCont=$("<table>",{"class":"ljo-rangeSlider-maxBoundCont"}).css("height",$(this.element).height()+"px").appendTo(this.element);this._garbageCollector.push(this.generatedElementBoundMaxCont);this.generatedElementBoundMinContTr1=$("<tr>").appendTo(this.generatedElementBoundMinCont);this._garbageCollector.push(this.generatedElementBoundMinContTr1);this.generatedElementBoundMaxContTr1=$("<tr>").appendTo(this.generatedElementBoundMaxCont);this._garbageCollector.push(this.generatedElementBoundMaxContTr1);this.generatedElementBoundMinIcon=$("<td>",{"class":"ui-icon ui-icon-circle-arrow-e"}).appendTo(this.generatedElementBoundMinContTr1);this._garbageCollector.push(this.generatedElementBoundMinIcon);this.generatedElementBoundMinTd=$("<td>",{"class":"ljo-rangeSlider-minBoundTd","data-role":"boundsmin"}).text(moment(this.options.range.bounds.min).format("DD/MM/YYYY")).appendTo(this.generatedElementBoundMinContTr1);this._garbageCollector.push(this.generatedElementBoundMinTd);this.generatedElementValuesMinTd=$("<td>",{"class":"ljo-rangeSlider-minValuesTd","data-role":"valuesmin"}).text(moment(this.options.range.values.min).format("DD/MM/YYYY")).appendTo(this.generatedElementBoundMinContTr1);this._garbageCollector.push(this.generatedElementValuesMinTd);this.generatedElementValuesMaxTd=$("<td>",{"class":"ljo-rangeSlider-maxValuesTd","data-role":"valuesmax"}).text(moment(this.options.range.values.max).format("DD/MM/YYYY")).appendTo(this.generatedElementBoundMaxContTr1);this._garbageCollector.push(this.generatedElementValuesMaxTd);this.generatedElementBoundMaxTd=$("<td>",{"class":"ljo-rangeSlider-maxBoundTd","data-role":"boundsmax"}).text(moment(this.options.range.bounds.max).format("DD/MM/YYYY")).appendTo(this.generatedElementBoundMaxContTr1);this._garbageCollector.push(this.generatedElementBoundMaxTd);this.generatedElementBoundEndIcon=$("<td>",{"class":"ui-icon ui-icon-circle-arrow-w"}).appendTo(this.generatedElementBoundMaxContTr1);this._garbageCollector.push(this.generatedElementBoundEndIcon);this._refresh(null)},_buildHandle:function(){this.generatedElementSlider},_sliderWidth:function(n){var t="0px",i,r;if(n==undefined)return this.options.behavior.dateMode?(i=moment(this.options.range.values.max).diff(moment(this.options.range.values.min),"milliseconds"),r=moment(this.options.range.bounds.max).diff(moment(this.options.range.bounds.min),"milliseconds"),t=this.element.width()*(i/r)):t=this.element.width()*((this.options.range.values.max-this.options.range.values.min)/(this.options.range.bounds.max-this.options.range.bounds.min)),t;n>=this.element.width()?this.element.find("ljo-rangeSlider-slider").css("width",this.element.width()+"px"):n<=0?this.element.find("ljo-rangeSlider-slider").css("width","0px"):this.element.find("ljo-rangeSlider-slider").css("width",n+"px")},_refresh:function(){console.log("ljo.rangeSlider _refresh")},min:function(n){if(n==undefined)return this.options.values.min;this.options.range.values.min=n;this._refresh()},max:function(n){if(n==undefined)return this.options.values.max;this.options.range.values.max=n;this._refresh()},boundMin:function(n){if(n==undefined)return this.options.bounds.min;this.options.range.bounds.min=n;this._refresh()},boundMax:function(n){if(n==undefined)return this.options.bounds.max;this.options.range.bounds.max=n;this._refresh()},widget:function(){return this.element},_destroy:function(){while(this._garbageCollector.length>0)this._garbageCollector[this._garbageCollector.length-1].remove(),this._garbageCollector.pop();this.generatedElementSlider.remove();this.element.removeClass("ljo-rangeSlider").enableSelection().css("background-color","transparent")},_setOptions:function(){this._superApply(arguments);this._refresh()},_setOption:function(n,t){this._super(n,t)}});$("#widget").on("widgetcreate",function(){alert("Hi again!")});